---
###############################################################################
# Configuration of OpenStack projects and users user environment.

# List of OpenStack projects. Format is as required by the stackhpc.os-projects
# role.
openstack_projects:
 - "{{ openstack_project_stackhpc }}"
# Definition of the openstack demo project. Format is as required by the
# stackhpc.os-projects role.
openstack_project_stackhpc:
  name: "stackhpc"
  description: "StackHPC demo project"
  project_domain: "default"
  user_domain: "default"
  users: "{{ openstack_stackhpc_users }}"
  quotas: "{{ openstack_project_quotas }}"

# StackHPC project users and roles
openstack_stackhpc_users:
  - name: "stackhpc-dmehmood"
    description: "Dawud Mehmood (StackHPC)"
    email: "dawud@stackhpc.com"
    password: "placeholder"
    roles: "{{ openstack_user_roles }}"
  - name: "stackhpc-mcrees"
    description: "Matt Crees (StackHPC)"
    email: "mattc@stackhpc.com"
    password: "placeholder"
    roles: "{{ openstack_user_roles }}"
  - name: "stackhpc-stelfer"
    description: "Stig Telfer (StackHPC)"
    email: "stig@stackhpc.com"
    password: "placeholder"
    roles: "{{ openstack_user_roles }}"
  - name: "stackhpc-sdavidson"
    description: "Scott Davidson (StackHPC)"
    email: "scott@stackhpc.com"
    password: "placeholder"
    roles: "{{ openstack_user_roles }}"

# List of roles to apply to regular users in the openstack demo project.
openstack_user_roles:
  - member
  - heat_stack_owner
  # This allows a user read and write access to octavia APIs.
  # https://docs.openstack.org/octavia/latest/configuration/policy.html
  - load-balancer_member
  # This allows a user read access to Barbican secrets.
  # https://docs.openstack.org/barbican/latest/admin/access_control.html
  - observer

# Dict of quotas to set for projects with basic resource quotas
openstack_project_quotas:
  backup_gigabytes: -1
  backups: -1
  cores: 250
  fixed_ips: 10
  floatingip: 10
  gigabytes: 10000
  injected_file_size: -1
  injected_files: -1
  instances: 20
  key_pairs: 10
  per_volume_gigabytes: 500
  ram: 1000000
  security_group: 10
  security_group_rule: 100
  snapshots: -1
  volumes: 50

# Dict of quotas to set for projects with unlimited resource quotas
openstack_unlimited_quotas:
  backup_gigabytes: -1
  backups: -1
  cores: -1
  fixed_ips: -1
  floatingip: -1
  gigabytes: -1
  injected_file_size: -1
  injected_files: -1
  instances: -1
  key_pairs: -1
  per_volume_gigabytes: -1
  ram: -1
  security_group: -1
  security_group_rule: -1
  snapshots: -1
  volumes: -1

###############################################################################
# Configuration of networks, subnets and routers.

# List of networks in the openstack system. Format is as required by the
# stackhpc.os-networks role.
openstack_networks:
  - "{{ openstack_network_external_internet }}"
  - "{{ openstack_network_external_ceph }}"
  - "{{ openstack_network_stackhpc }}"
  - "{{ openstack_network_stackhpc_vlan }}"


#
# External/Internet network
# Actually still a private subnet range but intended for outward-facing
# networking.
#
openstack_network_external_internet_name: "external"

openstack_network_external_internet:
  name: "{{ openstack_network_external_internet_name }}"
  project: "admin"
  provider_network_type: "vlan"
  provider_physical_network: "physnet1"
  provider_segmentation_id: 2803
  shared: false
  external: true
  # Subnet configuration.
  subnets:
    - "{{ openstack_subnet_external_internet }}"

openstack_subnet_external_internet:
  name: "{{ openstack_network_external_internet_name }}"
  project: "admin"
  cidr: "10.129.30.0/23"
  gateway_ip: "10.129.31.254"
  allocation_pool_start: "10.129.30.20"
  allocation_pool_end: "10.129.31.240"

#openstack_networks:

# List of routers in the openstack project. Format is as required by the
# stackhpc.os-networks role.
openstack_routers:
  - "{{ openstack_router_stackhpc }}"

# List of security groups in the openstack project.
# Format is as required by the stackhpc.os-networks role.
################################################################################
# Networks for stackhpc
#
openstack_network_stackhpc:
  name: "{{ openstack_project_stackhpc.name }}"
  project: "{{ openstack_project_stackhpc.name }}"
  shared: false
  external: false
  # Subnet configuration.
  subnets:
    - "{{ openstack_subnet_stackhpc }}"

openstack_subnet_stackhpc:
  name: "{{ openstack_project_stackhpc.name }}"
  project: "{{ openstack_project_stackhpc.name }}"
  cidr: "192.168.0.0/24"
  gateway_ip: "192.168.0.1"
  allocation_pool_start: "192.168.0.10"
  allocation_pool_end: "192.168.0.250"

openstack_network_stackhpc_vlan:
  name: "{{ openstack_project_stackhpc.name }}-vlan"
  project: "{{ openstack_project_stackhpc.name }}"
  shared: false
  external: false
  provider_network_type: "vlan"
  provider_physical_network: "physnet2"
  # This may be required for RDMA traffic
  port_security_enabled: false
  mtu: 9000
  # Subnet configuration.
  subnets:
    - "{{ openstack_subnet_stackhpc_vlan }}"

openstack_subnet_stackhpc_vlan:
  name: "{{ openstack_project_stackhpc.name }}-vlan"
  project: "{{ openstack_project_stackhpc.name }}"
  cidr: "192.168.1.0/24"
  gateway_ip: "192.168.1.1"
  allocation_pool_start: "192.168.1.10"
  allocation_pool_end: "192.168.1.250"

openstack_router_stackhpc:
  name: "{{ openstack_project_stackhpc.name }}"
  project: "{{ openstack_project_stackhpc.name }}"
  interfaces:
    - "{{ openstack_network_stackhpc.name }}"
    - "{{ openstack_network_stackhpc_vlan.name }}"
  network: "{{ openstack_network_external_internet.name }}"

openstack_secgroup_stackhpc:
  name: default
  project: "{{ openstack_project_stackhpc.name }}"
  rules: "{{ openstack_secgroup_rules_default }}"


###############################################################################
# Configuration of nova flavors.

# List of nova flavors in the openstack project. Format is as required by the
# stackhpc.os-flavors role.
openstack_flavors:
#  - "{{ openstack_flavor_godzilla }}"
  - "{{ hpc_v1_8cpu }}"
  - "{{ hpc_v1_16cpu }}"
  - "{{ hpc_v1_32cpu }}"
  - "{{ hpc_v1_48cpu }}"
  - "{{ hpc_v1_64cpu }}"
  - "{{ hpc_v1_80cpu }}"
  - "{{ hpc_v1_96cpu }}"

# openstack_flavor_godzilla:
#   name: "godzilla"
#   ram: 393216
#   disk: 50
#   vcpus: 96
#   is_public: true
#   extra_specs:
#     hw:cpu_policy: "dedicated"
#     hw:cpu_thread_policy: "prefer"
#     hw:cpu_threads: 2
#     hw:mem_page_size: "1GB"
#     hw:cpu_sockets: 2
#     hw:numa_nodes: 8
#     hw:pci_numa_affinity_policy: preferred
#     hw_rng:allowed: "True"

# HPC v1:
# Core-pinned VCPUs
# 4GB RAM per VCPU
# Spread across NUMA regions (but in thread sibling pairs)
#
hpc_v1_8cpu:
  name: "hpc.v1.8cpu"
  ram: 32768
  disk: 30
  vcpus: 8
  is_public: false
  extra_specs:
    hw:cpu_policy: "dedicated"
    hw:cpu_thread_policy: "prefer"
    hw:cpu_threads: 2
    hw:mem_page_size: "1GB"
    hw:cpu_sockets: 2
    hw:numa_nodes: 8
    hw:pci_numa_affinity_policy: preferred
    hw_rng:allowed: "True"

hpc_v1_16cpu:
  name: "hpc.v1.16cpu"
  ram: 65536
  disk: 30
  vcpus: 16
  is_public: false
  extra_specs:
    hw:cpu_policy: "dedicated"
    hw:cpu_thread_policy: "prefer"
    hw:cpu_threads: 2
    hw:mem_page_size: "1GB"
    hw:cpu_sockets: 2
    hw:numa_nodes: 8
    hw:pci_numa_affinity_policy: preferred
    hw_rng:allowed: "True"

hpc_v1_32cpu:
  name: "hpc.v1.32cpu"
  ram: 131072
  disk: 30
  vcpus: 32
  is_public: false
  extra_specs:
    hw:cpu_policy: "dedicated"
    hw:cpu_thread_policy: "prefer"
    hw:cpu_threads: 2
    hw:mem_page_size: "1GB"
    hw:cpu_sockets: 2
    hw:numa_nodes: 8
    hw:pci_numa_affinity_policy: preferred
    hw_rng:allowed: "True"

hpc_v1_48cpu:
  name: "hpc.v1.48cpu"
  ram: 196608
  disk: 30
  vcpus: 48
  is_public: false
  extra_specs:
    hw:cpu_policy: "dedicated"
    hw:cpu_thread_policy: "prefer"
    hw:cpu_threads: 2
    hw:mem_page_size: "1GB"
    hw:cpu_sockets: 2
    hw:numa_nodes: 8
    hw:pci_numa_affinity_policy: preferred
    hw_rng:allowed: "True"

hpc_v1_64cpu:
  name: "hpc.v1.64cpu"
  ram: 262144
  disk: 30
  vcpus: 64
  is_public: false
  extra_specs:
    hw:cpu_policy: "dedicated"
    hw:cpu_thread_policy: "prefer"
    hw:cpu_threads: 2
    hw:mem_page_size: "1GB"
    hw:cpu_sockets: 2
    hw:numa_nodes: 8
    hw:pci_numa_affinity_policy: preferred
    hw_rng:allowed: "True"

hpc_v1_80cpu:
  name: "hpc.v1.80cpu"
  ram: 327680
  disk: 30
  vcpus: 80
  is_public: false
  extra_specs:
    hw:cpu_policy: "dedicated"
    hw:cpu_thread_policy: "prefer"
    hw:cpu_threads: 2
    hw:mem_page_size: "1GB"
    hw:cpu_sockets: 2
    hw:numa_nodes: 8
    hw:pci_numa_affinity_policy: preferred
    hw_rng:allowed: "True"

hpc_v1_96cpu:
  name: "hpc.v1.96cpu"
  ram: 393216
  disk: 30
  vcpus: 96
  is_public: false
  extra_specs:
    hw:cpu_policy: "dedicated"
    hw:cpu_thread_policy: "prefer"
    hw:cpu_threads: 2
    hw:mem_page_size: "1GB"
    hw:cpu_sockets: 2
    hw:numa_nodes: 8
    hw:pci_numa_affinity_policy: preferred
    hw_rng:allowed: "True"

###############################################################################
# Configuration of nova host aggregates.

# List of nova host aggregates. Format is as required by the
# stackhpc.os_host_aggregates role.
#openstack_host_aggregates:

###############################################################################
# Configuration of Glance software images.

# List of Glance images. Format is as required by the stackhpc.os-images role.
#openstack_images:

# List of Diskimage Builder (DIB) elements paths to include in image builds.
#openstack_image_elements:

# List of Diskimage Builder (DIB) elements Git repositories to use in image
# builds.
#openstack_image_git_elements:

###############################################################################
# Configuration of Magnum container clusters.

# List of magnum cluster templates. Format is as required by the
# stackhpc.os-container-clusters role.
#openstack_container_clusters_templates:

###############################################################################
# Dummy variable to allow Ansible to accept this file.
workaround_ansible_issue_8743: yes
